# 需求描述


## 3.1 前置校验

* 支持在Publisher 平台，将测试环境数据同步迁移到生产环境
* 

## 3.2 可迁移数据


**客户端**

* 版本文件
  * 可指定迁移版本文件
    * 确认是否所有文件可直接迁移
    * 翻译文件是否可以直接复用
* 配置文件
  * 可指定迁移版本文件
* CDN
  * 选择是否迁移 CDN 源站配置
  * 选择是否迁移 CDN缓存配置
* 跨域配置
  * 选择是否迁移 


**服务端**

* 镜像仓库：
  * 可指定同步的镜像仓库
  * 镜像名称不可修改
* 应用：
  * 支持指定需要同步的应用
  * 支持修改应用别名
  * 同步应用类型、部署类型、容器配置、插件、挂载的文件、镜像等信息
* 共享文件
  * 当文件挂载的应用选择了同步，文件默认同步，不可取消
  * 支持同步指定的文件，文件名称不可修改
* 存储：
  * 支持指定需要同步的存储实例
  * 支持修改存储实例别名
  * 同步存储类型、引擎版本、实例类型、账号密码等信息
* 告警联系人（值班用户）
  * 同步值班用户配置
  * 检查用户是否已存在（按AppId、Name、DingTalkId），如果不存在则创建新的值班用户记录

  ## 

## 3.3 操作流程


前置条件：生产环境已完成初始化


点击【同步测试环境到生产】，可选择“全量同步”或“部分迁移”

* 全量同步：提示用户“测试环境的所有数据均同步至生产，包含版本文件、配置文件、CDN配置、源站配置、镜像文件、应用、存储实例、共享文件、告警联系人，同步后不可回退，请谨慎操作”
* 部分迁移：提示用户”您可以选择需要同步的数据，同步后不可回退，请谨慎操作“

若选择部分迁移，可操作内容如下：

* 客户端卡片
  * 版本文件
    * 列表展示版本名称，支持多选
  * 配置文件
    * 列表展示文件名称，支持多选
  * CDN
    * 单选项，选择是否迁移 CDN 源站配置
    * 单选项，选择是否迁移 CDN缓存配置
  * 跨域配置
    * 选择是否迁移 
* 服务端卡片
  * 应用
    * 列表选择应用名称，并新增一个字段为”迁移后应用别名“，展示值默认为所选应用别名，支持修改
    * 提示用户”应用同步将同步应用所有数据，包含应用类型、部署方式、容器配置、镜像、标签、插件、挂载的文件等应用配置“
  * 镜像
    * 列表展示镜像名称，默认选择 已经挂载应用且应用被选择迁移到正式环境的镜像，不可取消
    * 其他镜像支持选定和取消
  * 共享文件
    * 列表展示文件夹/文件名称，默认选择 已经挂载应用且应用被选择迁移到正式环境的文件，不可取消
    * 其他文件支持选定和取消
  * 存储
    * 列表展示存储别名，并新增一个字段为”迁移后存储别名“，展示值默认为所选存储别名，支持修改
    * 提示用户”存储同步将同步存储类型、引擎版本、实例类型、账号密码等信息，同步后不可回退，请谨慎操作“
  * 告警联系人（值班用户）
    * 单选项，选择是否迁移 告警联系人
* 确认后确认所有选择迁移的配置，二次点击确认后开启迁移
* 迁移过程中，展示每个组件迁移的进度，若任一迁移失败，其他内容进行迁移，但需输出迁移失败的组件名称和迁移成功的组件名称


 **业务规则**

* 迁移不支持中止
* 迁移失败的数据需要手动新建
* 服务端数据同步：镜像➡️共享文件➡️应用➡️存储➡️告警联系人，若镜像或共享文件同步失败，挂载的应用同样会失败
* 若客户端或服务端未初始化，则数据迁移时对应卡片显示”无可迁移数据“
* 正式环境未初始化时，可点击”初始化正式环境“，初始化正式环境


# UI交互

根据您提供的迁移流程，以下是一个交互UI设计草案，旨在提供一个清晰、直观的用户界面，以指导用户完成从测试环境到生产环境的数据迁移。

### 1. 迁移流程概览界面

#### 1.1 标题和描述
- **标题**：同步测试环境到生产
- **描述**：选择您想要同步的数据类型，确保所有信息准确无误。

#### 1.2 操作选项
- **全量同步按钮**：一个明显的按钮，用于触发全量同步操作。
  - 文案：全量同步
  - 提示：测试环境的所有数据将同步至生产环境，此操作不可回退。
- **部分迁移按钮**：另一个按钮，用于触发部分迁移操作。
  - 文案：部分迁移
  - 提示：选择需要同步的数据，此操作不可回退。

#### 1.3 迁移状态
- **状态信息**：显示当前迁移的状态（未开始、进行中、完成、失败）。

### 2. 部分迁移详细选择界面

#### 2.1 客户端迁移选项
- **版本文件**：多选列表框，列出所有版本文件。
- **配置文件**：多选列表框，列出所有配置文件。
- **CDN配置**：两个单选按钮，用于选择是否迁移CDN源站配置和缓存配置。
- **跨域配置**：单选按钮，用于选择是否迁移跨域配置。

#### 2.2 服务端迁移选项
- **应用**：多选列表框，列出所有应用，并提供输入框以修改迁移后的应用别名。
- **镜像**：多选列表框，列出所有镜像，已挂载的应用镜像默认选中。
- **共享文件**：多选列表框，列出所有共享文件，已挂载的应用文件默认选中。
- **存储**：多选列表框，列出所有存储实例，并提供输入框以修改迁移后的存储别名。
- **告警联系人**：单选按钮，用于选择是否迁移告警联系人。

#### 2.3 确认迁移
- **确认按钮**：在用户完成选择后，提供一个确认按钮以启动迁移。
  - 文案：确认并开始迁移
  - 提示：请确认所有选择，迁移一旦开始不可中止。

### 3. 迁移进度界面

#### 3.1 进度条
- **进度条**：为每个迁移组件显示一个进度条，显示迁移的进度。

#### 3.2 迁移结果
- **成功/失败提示**：在迁移完成后，显示迁移成功的组件和失败的组件。
  - 成功：绿色勾选图标和组件名称。
  - 失败：红色叉号图标和组件名称，以及失败原因。

### 4. 错误处理和回滚

#### 4.1 错误提示
- **错误弹窗**：如果迁移失败，弹出一个错误提示弹窗，列出失败的组件和原因。

#### 4.2 回滚选项
- **回滚按钮**：在错误弹窗中提供一个回滚按钮，允许用户尝试回滚操作。
  - 文案：尝试回滚

### 5. 初始化正式环境

#### 5.1 初始化按钮
- **初始化按钮**：如果正式环境未初始化，提供一个初始化按钮。
  - 文案：初始化正式环境

